global procedure InvShpdRn(record RcVc RepSpec)begin	record ORVc ORr,OR2r;	row ORVc ORrw;	record SHVc SHr;	row SHVc SHrw;	record IVVc IVr;	row IVVc IVrw;	record RetVc Retr;	row RetVc Retrw;	integer i,mtrw,ivi,ivmtrw,shi,shmtrw;	boolean TrHs,testf;	startreportnoheaderjob("Check Orders");		//ORr.SerNr = 6345;		//ORr.SerNr = -1;		while(loopmain(ORr,1,true))begin		//if(readfirstmain(ORr,1,true))then begin			If(ORr.Closed==0)then begin				mtrw = matrowcnt(ORr);				For(i=0;i<mtrw;i=i+1) begin					matrowget(ORr,i,ORrw);					if(ORrw.Shipd2!=ORrw.Invd)then begin						startformat(15);							outstring(0,"DblORVc",ORr.SerNr,false);							outstring(50,0,i+1,false);							outstring(100,0,ORrw.ArtCode,false);							outstring(180,0,ORrw.Shipd2-ORrw.Invd,false);							outstring(200,0,"----",false);						endformat;					end;				end; 						mtrw = matrowcnt(ORr);				For(i=0;i<mtrw;i=i+1) begin					matrowget(ORr,i,ORrw);						ORrw.Shipd2 = 0;						ORrw.Invd = 0;					matrowput(ORr,i,ORrw);	  				end; 							IVr.OrderNr = ORr.SerNr;				TrHs = true;				while(loopkey("OrderNr",IVr,1,TrHs))begin					testf = true;					if(IVr.OrderNr!=ORr.SerNr)then begin TrHs = false; testf = false; end;					if(IVr.OKFlag==0)then begin testf = false; end;					/*startformat(15);						outstring(0,0,IVr.SerNr,false);						outstring(0,0,IVrw.OrdRow,false);					endformat;*/					if(testf)then begin						mtrw = matrowcnt(IVr);						For(i=0;i<mtrw;i=i+1) begin							/*startformat(15);									outstring(0,0,IVr.SerNr,false);									outstring(0,0,IVrw.OrdRow,false);								endformat;*/							matrowget(IVr,i,IVrw);							if(IVrw.stp==kInvoiceRowTypeNormal)then begin								/*startformat(15);									outstring(0,0,IVr.SerNr,false);									outstring(0,0,IVrw.OrdRow,false);								endformat;*/								if(IVrw.OrdRow>-1)then begin																matrowget(ORr,IVrw.OrdRow,ORrw);									if(ORrw.ArtCode==IVrw.ArtCode)then begin										if(IVr.InvType==kInvoiceTypeCredit)then begin											IVrw.Quant = -IVrw.Quant;										end;										ORrw.Invd = ORrw.Invd + IVrw.Quant;										/*startformat(15);											outstring(0,0,"IV",false);											outstring(50,0,IVr.SerNr,false);											outstring(100,0,i,false);											outstring(120,0,IVrw.OrdRow,false);											outstring(170,0,IVrw.Quant,false);										endformat;*/										matrowput(ORr,IVrw.OrdRow,ORrw);									end;								end;							end;						end; 					end;								end;				resetloop(IVr);							SHr.OrderNr = ORr.SerNr;				TrHs = true;				while(loopkey("OrderKey",SHr,1,TrHs))begin					testf = true;					if(SHr.OrderNr!=ORr.SerNr)then begin TrHs = false; testf = false; end;					if(SHr.OKFlag==0)then begin testf = false; end;									if(testf)then begin						mtrw = matrowcnt(SHr);						For(i=0;i<mtrw;i=i+1) begin							matrowget(SHr,i,SHrw);								if(SHrw.OrdRow>-1)then begin									matrowget(ORr,SHrw.OrdRow,ORrw);									if(ORrw.ArtCode==SHrw.ArtCode)then begin										ORrw.Shipd2 = ORrw.Shipd2 + SHrw.Ship;										/*startformat(15);											outstring(0,0,"SH",false);											outstring(50,0,SHr.SerNr,false);											outstring(100,0,i,false);											outstring(120,0,SHrw.OrdRow,false);											outstring(170,0,SHrw.Ship,false);										endformat;*/										matrowput(ORr,SHrw.OrdRow,ORrw);									end;								end;						end; 					end;								end;				Resetloop(SHr);							Retr.OrdNr = ORr.SerNr;				TrHs = true;				while(loopkey("OrdNr",Retr,1,TrHs))begin					testf = true;					if(Retr.OrdNr!=ORr.SerNr)then begin TrHs = false; testf = false; end;					if(Retr.OKFlag==0)then begin testf = false; end;									if(testf)then begin						mtrw = matrowcnt(Retr);						For(i=0;i<mtrw;i=i+1) begin							matrowget(Retr,i,Retrw);								if(Retrw.OrdRow>-1)then begin									matrowget(ORr,Retrw.OrdRow,ORrw);									if(ORrw.ArtCode==Retrw.ArtCode)then begin										ORrw.Shipd2 = ORrw.Shipd2 - Retrw.Quant;										/*startformat(15);											outstring(0,0,"Retr",false);											outstring(50,0,Retr.SerNr,false);											outstring(100,0,i,false);											outstring(120,0,Retrw.OrdRow,false);											outstring(170,0,Retrw.Quant,false);										endformat;*/										matrowput(ORr,Retrw.OrdRow,ORrw);									end;								end;						end; 					end;								end;				Resetloop(Retr);							mtrw = matrowcnt(ORr);				For(i=0;i<mtrw;i=i+1) begin					matrowget(ORr,i,ORrw);					if(ORrw.Shipd2!=ORrw.Invd)then begin						startformat(15);							outstring(0,"DblORVc",ORr.SerNr,false);							outstring(50,0,i+1,false);							outstring(100,0,ORrw.ArtCode,false);							outstring(180,0,ORrw.Shipd2-ORrw.Invd,false);						endformat;					end;				end; 			end;						end;					endjob;return;end;